<%= form_tag ({controller: "comments", action: "create", method: "post"}) do %>
  <%= text_field_tag "content" %>
  <%= hidden_field_tag "user_id", "#{current_user.id}"%>
  <%= hidden_field_tag "book_id", "#{@book.id}"%>
  <input type=submit value='Comment'>
<% end %>

<!-- Problems here: -->
<!-- - Since there are forms for both posting and destroying comments, the script can't define which is which, so both forms get sent to the same script. Cannot get form to add a class or id name, even with research
-->
<script type="text/javascript" charset="utf-8">
  $(function () {
    $('form').submit(function(event) {
      event.preventDefault();
      var values = $(this).serialize();
      var posting = $.post('/comments', values);
      posting.done(function(data) {
        let comment = data['data'];
        let id = parseInt(comment["id"])
        let block = document.createElement("div");
        block.innerHTML = "<%=@book.comments.length+1%>."
        
        let contentLine = document.createElement("p");
        $(contentLine).attr('id', "comment-content");
        $(contentLine).text(comment["attributes"]['content']);

        let usernameLine = document.createElement("p");
        $(usernameLine).attr("id", "comment-username");
        $(usernameLine).text(comment["attributes"]['user']);
        //This is an attempt to get 'NUMBER. COMMENT'
        // $(usernameLine).text(`${id} ${comment["attributes"]["user"]}`);
        ///
        $(block).attr("data-id", id)
        $(block).addClass("comment")
        debugger
        $(block).append(contentLine)
        $(block).append(usernameLine)
        $('.js-comment').append(block)
        $('form input[type="text"]').val('');
      });
    });
  });
</script>
